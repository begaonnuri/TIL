## AOP

Aspect-Oriented Programming의 약자이다. 흩어진 Aspect를 모듈화 할 수 있는 프로그래밍 기법으로 OOP를 보완하는 수단이다. Aspect를 한 곳에 모아서 OOP를 더 잘 할 수 있게 해준다.



## 스프링 AOP

스프링은 AOP의 구현체를 제공한다. 스프링 AOP는 자체적으로 구현한 기능과 자바에 있는 AspectJ와 연동해서 사용하는 기능을 제공한다.

여러 클래스와 메소드에 걸쳐있는 비슷한 코드를 Concern이라고 하는데, AOP는 Aspect로  흩어진 코드(concern)들을 한 곳에 모아 독립적으로 정의한다.



### 사용 예시

- 트랜잭션의 경우 auto commit을 false로 만들고 쿼리를 실행한 후 커밋이나 롤백을 실행한다.
- 성능 로깅을 하는 경우 측정하는 기능 전후로 비슷한 코드가 중복이 된다.



### 용어

**해야할 일**과 **어디에 적용해야 하는지**를 묶어서 모듈화 한 것이 AOP이다.

- Aspect는 묶은 모듈이다.
- 모듈에는 Advice와 Pointcut이 들어간다.
- Advice는 해야할 일들이다.
- Pointcut은 적용할 위치이다.
- Target은 적용해야 하는 대상이다.
- Joinpoint는 합류점이다.
  - 가장 흔하게 사용할 Joinpoint는 메소드 실행 시점이다. 메소드를 실행할 때 이 Advice를 실행하라고 지정할 수 있다.
  - 생성자 호출 직전, 생성자 호출할때, 필드에 접근하기 전, 필드에서 값을 가져왔을 때 등 Advice를 끼워 넣을수 있는 지점이 Joinpoint이다.
- Joinpoint의 구체적인 subset이 Pointcut이다. 'A클래스에 있는 B라는 메소드를 호출할 때 적용해라'가 Pointcut이다.
  - joinpoint는 명세에 가깝다. Pointcut은 구체적인 지점을 나타낸다.



### 용어 예시

MemberService의 hello()라는 메소드 실행 전, 후에 hello와 bye를 출력한다고 가정한다. 이때 MemberService 빈이 `Target`, hello() 메소드 실행 전, 후가 `Pointcut`, 메소드 실행 전, 후라는 것이 `Joinpoint`, hello와 bye를 출력하는 일이 `Advice`입니다. Joinpoint가 메타정보이고 Pointcut이 구체적인 적용 지점이다.



## AOP 적용 방법

#### 컴파일 타임

- 자바파일을 클래스파일로 컴파일할때, 바이트코드를 조작하는 시점에 적용한다.

#### 로드 타임

- JVM에서 클래스를 로딩하는 시점에 적용한다. JVM에서 로딩 하는 시점에 클래스를 변경하는 것을 loadtime weaving이라고 한다. 
- loadtime weaver라는 자바 에이전트를 설정해야 한다.
- 로딩 시점에 약간의 성능 부하가 생긴다.
- AspectJ를 사용할 수 있어 다양한 문법을 사용할 수 있다.

#### 런타임

- 스프링 AOP가 사용하는 방법이다.

- A라는 빈을 만들 때 A를 감싼 A타입의 프록시 빈을 만드는데, 프록시 빈을 통해 실제 A가 갖고 있는 메소드를 호출하기 직전에 적용한다. 

- 빈을 생성하는 시점에 약간의 성능 부하가 생긴다.

- 별도의 컴파일러나 별도의 자바에이전트같은 설정을 하지 않아도 된다.

- 문법이 쉽고 별도의 학습이 필요 없다.

  

런타임 방법이 가장 현실적이고 자주 사용하게 될 방법이다. 경우에 따라서 다양한 Joinpoint를 사용해야 할 때 AspectJ 컴파일러로 컴파일을 하거나 별도의 자바 에이전트를 설정해서 loadtime weaving을 하는 방법이 있다.