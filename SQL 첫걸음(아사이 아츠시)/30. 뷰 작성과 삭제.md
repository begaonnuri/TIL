## 뷰

데이터베이스 객체로 등록할 수 없는 `SELECT`문을 객체로 관리할 수 있도록 이름을 붙인 것을 뷰라고 한다. 뷰를 참조하면 정의된 `SELECT`문의 결과를 테이블처럼 사용할 수 있다.

복잡한 쿼리문에서 서브쿼리 부분을 뷰로 대체해 간략하게 표현할 수 있다. 또한 복잡한 `SELECT`문을 데이터베이스에 등록해 두고 간단히 실행할 수 있다.

```sql
SELECT * FROM (SELECT * FROM sample54); -- 뷰 사용 전
SELECT * FROM sample_view_67; -- 뷰 사용 후
```

#### 가상 테이블

뷰는 테이블처럼 취급할 수 있지만 실체가 존재하지 않아서 **가상 테이블**이라고도 불린다. 하지만 **뷰는 테이블처럼 저장공간을 가지지 않는다**. 따라서 `SELECT`문에서만 사용하는 것이 권장된다. `INSERT`, `UPDATE`, `DELETE`문에서도 조건이 맞으면 사용이 가능하지만 주의할 필요가 있다.



## 뷰 생성과 삭제

#### 뷰 생성

뷰는 데이터베이스 객체이기 때문에 DDL로 생성하거나 삭제한다. `CREATE VIEW`의 `AS` 명령은 생략할 수 없다.

```sql
CREATE VIEW sample_view_67 AS SELECT * FROM sample54; -- 열 지정X
CREATE VIEW sample_view_672(n, v, v2) AS SELECT no, a, a*2 FROM sample54; -- 열 지정O
```

#### 뷰 삭제

```sql
DROP VIEW sample_view_67;
```



## 뷰의 약점

뷰는 테이블과 달리 대량의 저장공간을 필요로 하지 않는다. 데이터베이스에 저장되는 것은 `SELECT` 명령이기 때문이다. 대신 CPU자원을 사용한다.

뷰를 참조하면 뷰에 등록되어 있는 `SELECT`문이 실행된다. 결과는 일시적으로 보존되고 뷰를 참조할 때마다 `SELECT`문이 실행된다.

#### 머티리얼라이즈드 뷰(Materialized View)

뷰의 근원이 되는 테이블에 데이터 양이 많은 경우, 집계처리를 할 때도 뷰가 사용된다면 처리 속도가 많이 떨어질 수 밖에 없다. 뷰를 중첩하는 경우에도 처리 속도가 떨어진다.

이런 경우 머티리얼라이즈드 뷰를 사용해 회피할 수 있다. 일반적으로 뷰는 데이터를 일시적으로 저장했다가 쿼리가 종료될 때 함께 삭제된다. 머티리얼라이즈드 뷰는 테이블처럼 데이터를 저장장치에 저장해두고 사용한다. 뷰에 지정된 테이블의 데이터가 변경된 경우에만 `SELECT`문을 다시 실행해 데이터를 갱신한다. 이 과정은 RDBMS가 처리한다.

뷰에 지정된 테이블의 데이터가 자주 변경되지 않으면 머티리얼라이즈드 뷰를 사용해 뷰의 약점을 보완할 수 있다. 하지만 MySQL에선 사용할 수없고 Oracle과 DB2에서만 사용할 수 있다.

#### 함수 테이블

뷰를 구성하는 `SELECT` 명령은 단독으로 실행할 수 있어야 한다. 하지만 상관 서브쿼리의 경우 단독으로 실행할 수 없다.

이런 경우 함수 테이블을 사용해 회피할 수 있다. 함수 테이블은 테이블을 결과값으로 반환해주는 사용자 정의 함수이다. 함수의 인자를 지정해 결과값을 바꿔서 상관 서브쿼리처럼 동작할 수 있다.