## 트랜잭션

주문이 발생했을 때 주문 테이블과 주문상품 테이블에 변경이 생긴다. 주문 테이블엔 새로운 주문이 `INSERT`되고 주문상품 테이블엔 상품 개수 만큼 `INSERT`된다.

복수의 `INSERT` 명령을 수행하던 중 에러가 발생한 경우 실행된 `INSERT` 명령을 별도의 `DELETE` 명령을 통해 지워야 한다. 이처럼 몇 단계로 나누어 SQL 명령을 실행하는 경우 트랜잭션을 사용한다.



## 롤백과 커밋

트랜잭션을 사용하면 에러가 발생했을 때 **롤백**해서 종료할 수 있다. 롤백을 하면 트랜잭션 내에서 행해진 모든 변경사항을 폐기한다. 아무런 에러가 발생하지 않으면 변경사항을 적용하고 트랜잭션을 종료하는데, 이를 **커밋**이라고 한다.



#### 자동커밋

트랜잭션을 사용해서 데이터를 추가할 때는 자동커밋을 꺼야한다. `INSERT`, `UPDATE`, `DELETE`가 처리될 때마다 **트랜잭션은 기본적으로 자동커밋 상태이다.** MySQL 기준으로 `START TRANSACTION` 명령을 사용해 명시적으로 트랜잭션의 시작을 선언해야 한다.

트랜잭션을 종료할땐 `COMMIT` 명령을 사용해 커밋하거나 `ROLLBACK` 명령을 사용해 롤백할 수 있다.

트랜잭션 내에서 실행된 명령은 임시 데이터 영역에서 수행된다. `COMMIT` 명령을 내리면 변경사항이 적용되고, `ROLLBACK` 명령을 내리면 폐기된다.



## 트랜잭션 사용법

하나의 명령에 트랜잭션을 거는 것은 의미가 없다. 반드시 함께 처리해야 하는 명령을 트랜잭션으로 묶어 실행하는 것이다.

트랜잭션 시작 명령은 표준화되지 않아서, MySQL에선 `START TRANSACTION`을 사용하지만 Oracle이나 DB2에선 트랜잭션 시작 명령이 따로 없다.

`DELETE` 명령을 트랜잭션 내에서 실행하더라도 취소가 가능하다.