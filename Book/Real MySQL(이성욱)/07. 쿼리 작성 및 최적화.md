# 7.8 스키마 조작(DDL)

데이터베이스의 구조 및 정의를 생성하거나 변경하는 쿼리를 DDL(Data Definition Language)라고 한다.

DB나 테이블을 생성하거나 변경하는 대부분의 명령어가 DDL에 해당한다.

DDL 가운데 인덱스나 칼럼을 추가, 삭제하는 작업은 테이블의 모든 레코드를 임시 테이블로 복사하면서 처리하기 때문에 주의해야 한다.



## 7.8.1 데이터베이스

MySQL에서 데이터베이스는 단순히 테이블을 모아서 그룹화한다는 개념으로 사용하기 때문에 명령이 많지 않다.



### 데이터베이스 생성

```mysql
CREATE DATABASE [IF NOT EXISTS] employees CHARACTER SET utf8 COLLATE utf8_general_ci;
```

`CREATE DATABASE 데이터베이스명`을 통해 데이터베이스를 생성한다.

`CHARACTER SET` 과 `COLLATE` 를 지정하지 않으면 MySQL 서버의 character_set_server 시스템 변수에 저장된 값을 사용한다.

`IF NOT EXISTS` 를 지정한 경우 데이터베이스가 없는 경우에만 생성하고 존재한다면 무시된다.



### 데이터베이스 목록

```mysql
SHOW DATABASES LIKE '%emp%';
```

`SHOW DATABASES` 를 통해 MySQL 서버가 갖고 있는 데이터베이스 목록을 본다.

`LIKE`를 지정해 특정 문자열을 포함한 데이터베이스 목록을 볼 수 있다.



### 데이터베이스 선택

```mysql
USE employees;
```

`USE 데이터베이스명`을 통해 기본 데이터베이스를 선택할 수 있다.

기본 데이터베이스가 아닌 테이블이나 프로시저를 사용하려면 다음과 같이 데이터베이스명까지 명시해야한다.

```mysql
SELECT * FROM employees.departments;
```



### 데이터베이스 속성 변경

```mysql
ALTER DATABASE employees CHARACTER SET=euckr COLLATE=euckr_korean_ci;
```

`ALTER DATABSE 데이터베이스명` 을 통해 데이터베이스의 문자집합이나 콜레이션을 변경한다.

데이터베이스 생성과 달리 `=`가 들어가는 것을 주의하자.



### 데이터베이스 삭제

```sql
DROP DATABASE [IF EXISTS] employees;
```

`DROP DATABASE 데이터베이스명`을 통해 데이터베이스를 삭제한다.

`IF EXISTS`를 지정한 경우 존재할 경우만 삭제하고 존재하지 않으면 무시한다.



## 7.8.2 테이블

### 테이블 생성

```mysql
CREATE [TEMPORARY] TABLE [IF NOT EXISTS] tb_test(
  member_id BIGINT [UNSIGNED] [AUTO_INCREMENT],
  nickname CHAR(20) [CHARACTER SET 'utf8'] [COLLATE 'utf8_general_ci'] [NOT NULL],
  member_point INT [ZEROFILL] [DEFAULT 0],
  modified_ts TIMESTAMP [DEFAULT CURRENT_TIMESTAMP]
  gender ENUM('Female', 'Male'),
  hobby SET('Reading', 'Game'),
  PRIMARY KEY (member_id)
  UNIQUE INDEX (nickname),
  INDEX ix_memberpoint (member_point)
) ENGINE=InnoDB;
```



| 옵션            | 설명                                           |
| --------------- | ---------------------------------------------- |
| `TEMPORARY`     | 해당 커넥션에서만 사용 가능한 임시 테이블 생성 |
| `IF NOT EXISTS` | 테이블이 존재하지 않을 경우 생성               |
| `ENGINE` | 테이블이 사용할 스토리지 엔진 지정 |
| `DEFAULT` | 컬럼의 초기값 설정. 모든 컬럼에 사용 |
| `CHARACTER SET` | 문자집합 설정. 문자열 컬럼에 사용 |
| `COLLATE` | 콜레이션 설정. 문자열 컬럼에 사용 |
| `UNSIGNED` | 양수만 저장할지 설정. 숫자 타입 컬럼에 사용 |
| `ZEROFILL` | 숫자 값의 왼쪽에 0을 패딩할지 결정. 숫자 타입 컬럼에 사용 |
| `DEFAULT CURRENT_TIMESTAMP` | 자동으로 현재 시간으로 업데이트할지 결정. TIMESTAMP 타입에 사용 |
| `ENUM` or `SET` | 컬럼이 가질 수 있는 값 정의 |



### 테이블 구조 조회

```mysql
SHOW CREATE TABLE employees;
```

테이블의 CREATE TABLE 문장을 표시한다. 최초에 테이블을 생성할 때 실행한 내용은 아니지만 명령을 바로 사용할 수 있어서 유용하다.

칼럼 목록, 인덱스, 외래키 정보를 동시에 보여줘서 자주 사용한다.



```mysql
DESC employees;
```

`DESC`는 Description의 약어로 칼럼 정보를 표 형태로 보여준다.

인덱스, 외래키, 테이블 자체 속성을 보여주지 않아서 전체적인 구조를 한눈에 파악하긴 어렵다.



### 테이블 구조 변경

ALTER TABLE 명령을 통해 테이블의 속성 뿐만 아니라 인덱스와 칼럼을 추가/제거 할 수도 있다.

```mysql
ALTER TABLE employees CHARACTER SET 'euckr';
ALTER TABLE employees ENGINE=myisam;
```

문자집합을 변경하면 기존의 데이터는 변경되지 않고 추가되는 컬럼의 문자집합만 변경된다. 하지만 칼럼 단위로 문자집합을 설정하기 때문에 테이블의 기본 문자집합을 변경할 일은 거의 없다.

스토리지 엔진을 변경하면 내부적으로 테이블의 모든 레코드를 복사하면서 작업이 일어나기 때문에 주의해야 한다.

스토리지 엔진 변경은 테이블의 빈 공간(Fragmentation)을 제거해 공간을 최적화하는 테이블 리빌드 목적으로도 사용한다. `OPTIMIZE TABLE` 명령으로도 테이블 최적화를 할 수 있다. InnoDB에선 칼럼을 추가/삭제 하는 경우 테이블 최적화 작업이 선행된다.