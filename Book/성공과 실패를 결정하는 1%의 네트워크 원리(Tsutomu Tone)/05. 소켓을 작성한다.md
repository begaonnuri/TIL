## 프로토콜 스택의 내부 구성

먼저 **네트워크 애플리케이션**이다. 브라우저, 메일 애플리케이션, 웹 서버, 메일 서버 등이 해당된다. 네트워크 애플리케이션에선 데이터 송수신을 의뢰한다.

다음은 **Socket 라이브러리**다. 라이브러리 안엔 **리졸버**가 내장되어있다.

다음은 OS의 내부인데 여기에 **프로토콜 스택**이 있다. 프로토콜 스택의 윗부분에는 **TCP**를 사용하는 부분과 **UDP**를 사용하는 부분이 있어서 이 둘이 애플리케이션에서 보낸 의뢰를 받아 송수신 동작을 실행한다. 브라우저나 메일 등 일반적인 애플리케이션 데이터를 송수신 할 때는 TCP를 사용하고 DNS 서버 조회 등 짧은 제어용 데이터를 송수신 할 때는 UDP를 사용한다.

그 아래엔 IP 프로토콜을 사용해 패킷 송수신 동작을 제어하는 부분이 있다. 인터넷에서 데이터를 운반할 때는 작게 나눈 패킷 형태로 운반하는데, 이 패킷을 수신측까지 운반하는 것이 IP의 역할이다. 그리고 IP 안에는 ICMP와 ARP라는 프로토콜이 포함되어 있다. ICMP는 패킷을 운반할 때 발생하는 오류를 통지하거나 제어용 메시지를 통지할 때 사용하고, ARP는 IP 주소에 대응하는 이더넷의 MAC 주소를 조사할 때 사용한다.

IP의 아래에 있는 LAN 드라이버는 LAN 어댑터의 하드웨어를 제어한다. 그리고 그 아래에 있는 LAN 어댑터가 케이블에 신호를 송수신하는 동작을 수행한다.



## 소켓의 실체는 통신 제어용 제어 정보

프로토콜 스택 내부엔 제어 정보를 기록하는 메모리 영역이 있는데, 여기엔 통신 상대의 IP 주소, 포트 번호, 통신의 진행 상태 등의 정보가 저장된다. 프로토콜 스택은 이 제어 정보를 참조하면서 동작한다. 이것이 소켓의 역할이다.

소켓을 만드는 동작은 여기부터 통신을 시작하는 곳이라고 상태를 기록하거나 송수신 데이터를 일시적으로 젖아하는 버퍼 메모리를 준비하는 등 통신을 준비하는 작업이다.



## Socket을 호출했을 때 동작

처음엔 소켓을 만드는 단계이다. socket 모듈을 호출해 소켓을 만들 것을 의뢰하면 프로토콜 스택은 하나의 소켓을 만든다. 이때 프로토콜 스택은 소켓 한 개 분량의 메모리 영역을 확보한다. 이후 제어 정보를 메모리에 기록한다. 이 과정을 통해 소켓이 만들어진다.

소켓이 만들어지면 소켓을 나타내는 **디스크립터**를 애플리케이션에게 알려준다. 디스크립터는 소켓을 식별하는 정보이다.

디스크립터를 받은 애플리케이션은 이후 데이터 송수신 동작을 프로토콜 스택에게 의뢰할 때 디스크립터를 알려준다. 디스크립터를 통해 어떤 소켓인지 알게 되면 나머지 정보는 프로토콜 스택쪽에서 알 수 있기 때문이다. 이로 인해 수신측의 정보를 일일이 통지받을 필요가 없어진다.