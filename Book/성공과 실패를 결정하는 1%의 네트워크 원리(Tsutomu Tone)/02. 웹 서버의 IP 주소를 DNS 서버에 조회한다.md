## IP 주소의 기본

HTTP 메시지를 만들면 OS에 의뢰해서 액세스 대상의 웹 서버에 송신한다. 브라우저는 URL을 해독하고 HTTP 메시지를 만들지만 HTTP 메시지를 네트워크에 송출하는 기능은 없기 때문에 OS에 의뢰하는 것이다.

이때 URL에 있는 도메인명을 통해 IP주소를 알아야한다.

인터넷이나 LAN은 **TCP/IP** 기반이다. TCP/IP는 여러 PC로 이루어진 **서브넷**이 라우터로 접속해 전체 네트워크가 만들어지는 것이다. 이때 `ㅇㅇ동ㅇㅇ번지` 형태로 네트워크 주소를 할당한다. 동에 해당하는 번호를 서브넷에 할당하고, 번지에 해당하는 번호를 컴퓨터에 할당한 것이 네트워크 주소이다. 동에 해당하는 번호를 **네트워크 번호**, 번지에 해당하는 번호를 **호스트 번호**라고 하고 두 주소를 합쳐서 **IP 주소**라고 한다.

IP 주소를 통해 대상이 어디있는지 판단하고 패킷 형태로 운반된다. 순서는 다음과 같다.

1. 송신자의 서브넷에 있는 허브
2. 송신자와 가장 가까운 라우터
3. 수신자까지 경로에 있는 라우터
4. 수신자와 가장 가까운 라우터
5. 수신자의 서브넷에 있는 허브



IP 주소는 32비트의 디지털 데이터로 8비트(1바이트)씩 점으로 구분해서 10진수로 표시한다. 하지만 IP 주소에서 어떤 부분이 네트워크 번호이고 어떤 부분이 호스트 번호인지 알 수 없다. 그래서 이것을 파악하기 위해 덧붙이는 정보를 **넷마스크**라고 한다.

넷마스크는 IP 주소와 같이 32비트의 디지털 데이터다. 넷마스크가 1인 부분은 네트워크 번호를 나타내고, 넷마스크가 0인 부분은 호스트 번호를 나타낸다.

IP 주소와 넷마스크를 모두 표기하면 다음과 같다. `10.11.12.13/255.255.255.0`

하지만 위와 같이 표시하면 너무 길기 때문에 다음과 같이 비트 수로 표시하기도 한다. `10.11.12.13/24`

호스트 번호가 0 또는 1인 경우 의미를 갖는다. `10.11.12.0` 처럼 호스트 번호가 0인 경우 서브넷 자체를 가리키고, `10.11.12.1` 처럼 호스트 번호가 1인 경우 서브넷에 있는 기기 전체에 패킷을 보내는 **브로드캐스트**를 의미한다.



## 도메인명과 IP 주소를 구분하여 사용하는 이유

숫자를 나열한 IP 주소는 기억하기 어렵기 때문에 서버의 이름을 사용한다. 또한 이름을 사용해 통신할 경우, 32비트의 IP 주소와 달리 수십 바이트를 다뤄야 하기 때문에 라우터가 부하되어 속도가 느려진다.

그래서 사람은 이름을 사용하고 라우터는 IP 주소를 사용하는 방법이 **DNS**이다.



## Socket 라이브러리가 IP 주소를 찾는 기능을 제공한다

IP 주소는 가장 가까운 DNS 서버에 도메인 명을 질의하면 알 수 있다. DNS 서버에 대해 클라이언트로 동작한다는 말인데, 여기서 DNS 클라이언트에 해당하는 것을 **DNS 리졸버** 또는 **리졸버(resolver)**라고 한다. 또한 DNS의 원리를 사용해 IP 주소를 조사하는 것을 **네임 리졸루션(name resolution)**이라고 한다. 리졸버가 네임 리졸루션을 실행하는 것이다.

리졸버는 Socket 라이브러리에 있는 모듈이다.



## 리졸버를 이용하여 DNS 서버를 조회한다

라이브러리를 통해 리졸버를 호출하면 리졸버가 DNS 서버에 조회 메시지를 보내고 DNS 서버에서 응답 메시지를 받는다. 리졸버는 응답 메시지에서 IP 주소를 추출해 메모리 영역에 저장한다. 브라우저는 메모리 영역에서 IP 주소를 읽어 HTTP 리퀘스트 메시지와 함께 OS에 의뢰한다.



## 리졸버 내부의 작동

리졸버를 호출하면 제어권이 리졸버 내부로 넘어간다. 프로그램이 순차적으로 실행되다가 호출하는 부분에서 실행을 멈추고 리졸버가 동작하는 것을 제어권이 넘어간다고 한다.

리졸버에 제어가 넘어가면 여기서 DNS 서버에 요청하기 위한 메시지를 만든다. 문자로 표현하는 HTTP 메시지와 달리 DNS 메시지는 바이너리 데이터로 표현한다. 만든 메시지를 OS 내부에 있는 **프로토콜 스택**을 호출해서 의뢰한다. 리졸버도 브라우저처럼 네트워크에 송수신 하는 기능이 없기 때문이다.

IP 주소를 가져오는 과정은 다음과 같다.

1. 액세스 대상의 웹 서버가 DNS 서버에 등록이 되어있으면 해당 정보를 클라이언트에게 응답한다.
2. 프로토콜 스택을 통해 리졸버에게 전달한다.
3. 리졸버는 응답받은 내용에서 IP 주소를 추출해 메모리에 저장한다.
4. 리졸버의 동작이 끝나고 제어권이 브라우저로 돌아온다.