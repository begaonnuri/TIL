## DNS 서버의 기본 동작

DNS 서버의 기본 동작은 조회 메시지를 받고 응답하는 것이다. 조회 메시지엔 다음 정보가 포함되어있다.

1. 이름 : 서버의 이름 
2. 클래스 : 인터넷 이외의 네트워크를 고려해서 만들어졌지만 지금은 인터넷만 사용되기 때문에 항상 `IN`이다.
3. 타입 : 이름이 어떤 타입인지를 나타낸다. IP 주소인 경우 Address의 `A`이고, 메일인 경우 Mail Exchange의 `MX`이다.



DNS 서버는 이름, 클래스, 타입이 일치하는 항목을 찾아서 IP 주소를 반환한다. 메일 서버의 경우 `@` 뒤에 있는 이름을 조회해서 메일 서버 이름과 우선순위를 반환한다. 우선순위는 복수의 메일 서버가 등록된 경우 어떤 서버를 선택해야 하는지를 나타낸다.

A와 MX 이외에도 PTR, CNAME, NS, SOA 등 다양한 타입이 있다.



## 도메인의 계층

수 많은 서버를 1대의 DNS 서버에 등록하는 것은 불가능하다. 정보를 다수의 DNS 서버에 등록하고 찾아내는 구조이다.

DNS 서버의 정보는 **도메인명**으로 계층적인 구조를 가진다. `www.lab.cyber.co.kr`에서 kr, co, cyber, lab, www를 **도메인**이라고 하고 계층으로 구분한다. kr은 대한민국에 할당된 도메인이다. 그 하위에 co는 국내의 도메인을 분류하는 도메인이고 회사를 나타낸다. 그 하위의 cyber가 회사에 할당된 도메인이고 www가 서버의 이름이다.



## 담당 DNS 서버를 찾아 IP 주소를 가져온다

com이나 kr같은 **최상위 도메인**의 DNS 서버에 하위의 DNS 서버가 등록되어 있다. 최상위 도메인 상위에 하나의 도메인이 더 있는데 이것을 **루트 도메인**이라고 한다. 일반적으로 생략하지만 `www.lab.cyber.com.` 처럼 마지막에 `.` 을 붙여서 명시적으로 표현할 수도 있다.

루트 도메인의 DNS 서버는 인터넷에 존재하는 DNS 서버에 전부 등록되어서 어디서든지 루트 도메인에 액세스할 수 있다. 따라서 다음과 같은 순서로 DNS 서버에 접근한다.

1. 가장 가까운 DNS 서버
2. 루트 도메인
3. 루트 도메인의 하위 도메인(찾을때 까지 반복)
4. 찾고자 하는 도메인의 DNS 서버

가장 가까운 DNS 서버는 2, 3, 4 순서대로 다른 DNS 서버에게 조회 메시지를 보내고 응답받는다. 최종적으로 원하는 DNS 서버에서 IP 주소를 받아 클라이언트에게 응답한다.



## DNS 서버는 캐시 기능으로 빠르게 회답할 수 있다

위의 과정은 현실의 인터넷과는 다른 부분이 있다. 현실의 인터넷에선 한대의 DNS 서버에 복수의 도메인 정보를 등록할 수 있다. 또한 상위와 하위 도메인을 같은 DNS 서버에 등록하는 경우도 있다. 이 경우 하위 DNS 서버에 묻는 과정을 한 단계 건너 뛴다고 생각하면 된다.

DNS 서버에선 한 번 조사한 이름을 캐싱해둔다. 캐시 정보가 있으면 캐시 정보를 응답하기 때문에 위 과정을 거치지 않을 수도 있다. 또한 조회한 이름이 도메인에 등록되지 않은 경우 존재하지 않는 응답과 함께 캐싱해둬서 존재하지 않는 경우에도 빠르게 응답한다.

캐싱한 값이 변경되는 경우도 있기 때문에 유효 기간을 정해둔다. 또한 조회에 대한 응답을 할 때 캐싱된 값인지 DNS 서버에서 찾은 값인지 알려준다.